"""
æ–‡æœ¬æ¸…ç†åŠŸèƒ½æ¸¬è©¦è…³æœ¬
å°ˆé–€æ¸¬è©¦è¡¨æƒ…ç¬¦è™Ÿå’Œç‰¹æ®Šå­—å…ƒçš„è™•ç†
"""

import logging
import sys
from pathlib import Path

# æ·»åŠ çˆ¶ç›®éŒ„åˆ°è·¯å¾‘
sys.path.append(str(Path(__file__).parent))

from vector_pipeline.utils.text_cleaner import TextCleaner

# é…ç½®æ—¥èªŒ
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)


def test_text_cleaning():
    """æ¸¬è©¦æ–‡æœ¬æ¸…ç†åŠŸèƒ½"""
    cleaner = TextCleaner()
    
    # æ¸¬è©¦æ¡ˆä¾‹
    test_cases = [
        # åŸºæœ¬è¡¨æƒ…ç¬¦è™Ÿæ¸¬è©¦
        "ğŸ§ ç§‘æŠ€æ–°çŸ¥ï¼šAI äººå·¥æ™ºæ…§æœ€æ–°ç™¼å±• ğŸ”¥",
        "å•†æ¥­ç®¡ç†ï¼šä¼æ¥­ç¶“ç‡Ÿç­–ç•¥èˆ‡é ˜å°åŠ› ğŸ’¼",
        "æ•™è‚²å­¸ç¿’ï¼šå¦‚ä½•æå‡å­¸ç¿’æ•ˆç‡ ğŸ“š",
        "å‰µæ¥­æ•…äº‹ï¼šå¾é›¶åˆ°ä¸€çš„å‰µæ¥­æ­·ç¨‹ ğŸš€",
        "å¥åº·ç”Ÿæ´»ï¼šç‡Ÿé¤Šèˆ‡é‹å‹•çš„å¹³è¡¡ âš–ï¸",
        
        # ç‰¹æ®Šå­—ç¬¦æ¸¬è©¦
        "AIæŠ€è¡“Â® ç‰ˆæ¬Šæ‰€æœ‰ Â© 2024",
        "ä¼æ¥­å•†æ¨™â„¢ æœå‹™æ¨™è¨˜â„ ",
        "æº«åº¦è®ŠåŒ–ï¼š25Â°C åˆ° 30Â°C",
        "æ•¸å­¸å…¬å¼ï¼šâˆ‘(xÂ²) = âˆ",
        
        # æ··åˆæ¸¬è©¦
        "ğŸ¯ æŠ•è³‡ç†è²¡ï¼šè‚¡ç¥¨å¸‚å ´åˆ†æ ğŸ“ˆ 2024å¹´è¶¨å‹¢",
        "ğŸ¥ é†«ç™‚ç§‘æŠ€ï¼šAIè¨ºæ–·ç³»çµ± âš•ï¸ æœ€æ–°çªç ´",
        "ğŸ¨ æ–‡åŒ–è—è¡“ï¼šç¾ä»£è—è¡“å±•è¦½ ğŸ–¼ï¸ ç²¾å½©å›é¡§",
        
        # è¤‡é›œè¡¨æƒ…ç¬¦è™Ÿ
        "ğŸ‡¹ğŸ‡¼ å°ç£ç§‘æŠ€ï¼šæœ¬åœŸAIç™¼å±• ğŸ‡¯ğŸ‡µ èˆ‡æ—¥æœ¬åˆä½œ",
        "ğŸ‘¨â€ğŸ’» ç¨‹å¼é–‹ç™¼ï¼šå…¨ç«¯å·¥ç¨‹å¸« ğŸ‘©â€ğŸ’¼ èˆ‡ç”¢å“ç¶“ç†",
        "ğŸ¢ ä¼æ¥­æ–‡åŒ–ï¼šåœ˜éšŠåˆä½œ ğŸ¤ èˆ‡å‰µæ–°æ€ç¶­",
        
        # é•·æ–‡æœ¬æ¸¬è©¦
        """
        ğŸ§ æ’­å®¢ç¯€ç›®ï¼šæ·±åº¦è¨ªè«‡ç³»åˆ—
        ğŸ”¥ ç†±é–€è©±é¡Œï¼šäººå·¥æ™ºæ…§åœ¨å•†æ¥­ä¸­çš„æ‡‰ç”¨
        ğŸ’¡ å‰µæ–°æ€ç¶­ï¼šå¦‚ä½•é‹ç”¨AIæå‡ä¼æ¥­æ•ˆç‡
        ğŸ“Š æ•¸æ“šåˆ†æï¼šå¸‚å ´è¶¨å‹¢èˆ‡æŠ•è³‡æ©Ÿæœƒ
        ğŸŒŸ æˆåŠŸæ¡ˆä¾‹ï¼šå¾å‰µæ¥­åˆ°ä¸Šå¸‚çš„å®Œæ•´æ­·ç¨‹
        """,
        
        # ç‰¹æ®Šæƒ…æ³
        "  å¤šé¤˜ç©ºç™½  å’Œæ›è¡Œ\n\nè™•ç†  ",
        "Unicodeæ¨™æº–åŒ–ï¼šcafÃ© vs cafÃ©",
        "æ··åˆèªè¨€ï¼šAIæŠ€è¡“ + äººå·¥æ™ºæ…§ + Artificial Intelligence"
    ]
    
    logger.info("=== é–‹å§‹æ–‡æœ¬æ¸…ç†æ¸¬è©¦ ===")
    
    for i, text in enumerate(test_cases, 1):
        logger.info(f"\n--- æ¸¬è©¦æ¡ˆä¾‹ {i} ---")
        logger.info(f"åŸå§‹æ–‡æœ¬: {text}")
        
        # åŸºæœ¬æ¸…ç†
        cleaned = cleaner.clean_text(text)
        logger.info(f"æ¸…ç†å¾Œ: {cleaned}")
        
        # æ¨™é¡Œæ¨™æº–åŒ–
        normalized = cleaner.normalize_title(text)
        logger.info(f"æ¨™æº–åŒ–æ¨™é¡Œ: {normalized}")
        
        # æœç´¢è®Šé«”
        variants = cleaner.create_search_variants(text)
        logger.info(f"æœç´¢è®Šé«”: {variants}")
        
        # ç›¸ä¼¼åº¦æ¸¬è©¦ï¼ˆèˆ‡æ¸…ç†å¾Œçš„æ–‡æœ¬æ¯”è¼ƒï¼‰
        similarity = cleaner.is_similar_title(text, cleaned)
        logger.info(f"èˆ‡æ¸…ç†å¾Œæ–‡æœ¬ç›¸ä¼¼åº¦: {similarity}")
        
        logger.info("-" * 50)


def test_specific_emojis():
    """æ¸¬è©¦ç‰¹å®šè¡¨æƒ…ç¬¦è™Ÿ"""
    cleaner = TextCleaner()
    
    logger.info("\n=== ç‰¹å®šè¡¨æƒ…ç¬¦è™Ÿæ¸¬è©¦ ===")
    
    # æ¸¬è©¦å¸¸è¦‹è¡¨æƒ…ç¬¦è™Ÿ
    emoji_tests = [
        "ğŸ˜€ğŸ˜ƒğŸ˜„ğŸ˜ğŸ˜†ğŸ˜…ğŸ˜‚ğŸ¤£",  # ç¬‘è‡‰ç³»åˆ—
        "ğŸ˜ŠğŸ˜‡ğŸ™‚ğŸ™ƒğŸ˜‰ğŸ˜ŒğŸ˜ğŸ¥°",  # æ­£é¢æƒ…ç·’
        "ğŸ˜˜ğŸ˜—ğŸ˜™ğŸ˜šğŸ˜‹ğŸ˜›ğŸ˜ğŸ˜œ",  # è¦ªå»ç³»åˆ—
        "ğŸ¤ªğŸ¤¨ğŸ§ğŸ¤“ğŸ˜ğŸ¤©ğŸ¥³ğŸ˜",  # å…¶ä»–è¡¨æƒ…
        "ğŸ˜’ğŸ˜ğŸ˜”ğŸ˜ŸğŸ˜•ğŸ™â˜¹ï¸ğŸ˜£",  # è² é¢æƒ…ç·’
        "ğŸ˜–ğŸ˜«ğŸ˜©ğŸ¥ºğŸ˜¢ğŸ˜­ğŸ˜¤ğŸ˜ ",  # æ›´å¤šè² é¢æƒ…ç·’
        "ğŸ˜¡ğŸ¤¬ğŸ¤¯ğŸ˜³ğŸ¥µğŸ¥¶ğŸ˜±ğŸ˜¨",  # æ¥µç«¯æƒ…ç·’
        "ğŸ˜°ğŸ˜¥ğŸ˜“ğŸ¤—ğŸ¤”ğŸ¤­ğŸ¤«ğŸ¤¥",  # è¤‡é›œæƒ…ç·’
        "ğŸ˜¶ğŸ˜ğŸ˜‘ğŸ˜¯ğŸ˜¦ğŸ˜§ğŸ˜®ğŸ˜²",  # é©šè¨ç³»åˆ—
        "ğŸ˜´ğŸ¤¤ğŸ˜ªğŸ˜µğŸ¤ğŸ¥´ğŸ¤¢ğŸ¤®",  # èº«é«”ç‹€æ…‹
        "ğŸ¤§ğŸ˜·ğŸ¤’ğŸ¤•ğŸ¤‘ğŸ¤ ğŸ‘»ğŸ‘½",  # å…¶ä»–ç‹€æ…‹
        "ğŸ¤–ğŸ˜ˆğŸ‘¿ğŸ‘¹ğŸ‘ºğŸ’€â˜ ï¸ğŸ’©",  # ç‰¹æ®Šè§’è‰²
        "ğŸ¤¡ğŸƒğŸ‘¾ğŸ˜ºğŸ˜¸ğŸ˜¹ğŸ˜»ğŸ˜¼",  # å‹•ç‰©è¡¨æƒ…
        "ğŸ˜½ğŸ™€ğŸ˜¿ğŸ˜¾ğŸ™ˆğŸ™‰ğŸ™ŠğŸ’Œ",  # æ›´å¤šå‹•ç‰©
        "ğŸ’˜ğŸ’ğŸ’–ğŸ’—ğŸ’“ğŸ’ğŸ’•ğŸ’Ÿ",  # æ„›å¿ƒç³»åˆ—
        "â£ï¸ğŸ’”â¤ï¸ğŸ§¡ğŸ’›ğŸ’šğŸ’™ğŸ’œ",  # å½©è‰²æ„›å¿ƒ
        "ğŸ–¤ğŸ¤ğŸ¤ğŸ’¯ğŸ’¢ğŸ’¥ğŸ’«ğŸ’¦",  # å…¶ä»–ç¬¦è™Ÿ
        "ğŸ’¨ğŸ•³ï¸ğŸ’¬ğŸ—¨ï¸ğŸ—¯ï¸ğŸ’­ğŸ’¤ğŸ’®",  # å°è©±æ¡†ç³»åˆ—
        "â™¨ï¸ğŸ’ˆğŸ›‘ğŸ›¢ï¸ğŸ› ï¸ğŸ›¡ï¸ğŸ›¤ï¸ğŸ›¥ï¸",  # äº¤é€šç¬¦è™Ÿ
        "ğŸ›©ï¸ğŸ›«ğŸ›¬ğŸ›°ï¸ğŸ›³ï¸ğŸ›´ğŸ›µğŸ›¶",  # äº¤é€šå·¥å…·
        "ğŸ›·ğŸ›¸ğŸ›¹ğŸ›ºğŸ›»ğŸ›¼ğŸŸ ğŸŸ¡",  # æ›´å¤šäº¤é€šå·¥å…·
        "ğŸŸ¢ğŸŸ£ğŸŸ¤âš«âšªğŸŸ¥ğŸŸ§ğŸŸ¨",  # é¡è‰²å½¢ç‹€
        "ğŸŸ©ğŸŸ¦ğŸŸªğŸŸ«â¬›â¬œâ—¼ï¸â—»ï¸",  # æ›´å¤šå½¢ç‹€
        "â—¾â—½â–ªï¸â–«ï¸ğŸ”¶ğŸ”·ğŸ”¸ğŸ”¹",  # é‘½çŸ³ç³»åˆ—
        "ğŸ”ºğŸ”»ğŸ’ ğŸ”˜ğŸ”³ğŸ”²ğŸğŸš©",  # æ——å¹Ÿç³»åˆ—
        "ğŸŒğŸ´ğŸ³ï¸ğŸ³ï¸â€ğŸŒˆğŸ´â€â˜ ï¸ğŸ‡¹ğŸ‡¼ğŸ‡¯ğŸ‡µğŸ‡ºğŸ‡¸ğŸ‡¬ğŸ‡§",  # åœ‹æ——ç³»åˆ—
    ]
    
    for i, emoji_text in enumerate(emoji_tests, 1):
        logger.info(f"\nè¡¨æƒ…ç¬¦è™Ÿæ¸¬è©¦ {i}: {emoji_text}")
        cleaned = cleaner.clean_text(emoji_text)
        logger.info(f"æ¸…ç†å¾Œ: {cleaned}")


def test_special_characters():
    """æ¸¬è©¦ç‰¹æ®Šå­—ç¬¦"""
    cleaner = TextCleaner()
    
    logger.info("\n=== ç‰¹æ®Šå­—ç¬¦æ¸¬è©¦ ===")
    
    special_char_tests = [
        "è¨»å†Šå•†æ¨™Â® ç‰ˆæ¬ŠÂ© å•†æ¨™â„¢",
        "æœå‹™å•†æ¨™â„  éŒ„éŸ³ç‰ˆæ¬Šâ„— è½‰äº¤â„…",
        "ç·¨è™Ÿâ„– é›»è©±â„¡ è™•æ–¹â„ å›æ‡‰â„Ÿ",
        "æº«åº¦ï¼š25Â°C åˆ° 30Â°F",
        "è§’åº¦ï¼š90Â° åˆ†â€² ç§’â€³",
        "æ¯”ä¾‹ï¼š5â€° è¬åˆ†æ¯”â€±",
        "æ•¸å­¸ï¼šâˆ âˆ… âˆˆ âˆ‰ âˆ‹ âˆŒ",
        "é‹ç®—ï¼šâˆ âˆ‘ âˆš âˆ› âˆœ Â± âˆ“",
        "ç¬¦è™Ÿï¼šÃ— Ã· âˆ• âˆ— âˆ˜ âˆ™ â‹… â‹†",
        "é‚è¼¯ï¼šâ‹ˆ â‹‰ â‹Š â‹‹ â‹Œ â‹ â‹ â‹",
        "é›†åˆï¼šâ‹ â‹‘ â‹’ â‹“ â‹” â‹• â‹– â‹—",
        "æ¯”è¼ƒï¼šâ‹˜ â‹™ â‹š â‹› â‹œ â‹ â‹ â‹Ÿ",
        "é—œä¿‚ï¼šâ‹  â‹¡ â‹¢ â‹£ â‹¤ â‹¥ â‹¦ â‹§",
        "åŒ…å«ï¼šâ‹¨ â‹© â‹ª â‹« â‹¬ â‹­ â‹® â‹¯",
        "çœç•¥ï¼šâ‹° â‹± â‹² â‹³ â‹´ â‹µ â‹¶ â‹·",
        "æ›´å¤šï¼šâ‹¸ â‹¹ â‹º â‹» â‹¼ â‹½ â‹¾ â‹¿"
    ]
    
    for i, char_text in enumerate(special_char_tests, 1):
        logger.info(f"\nç‰¹æ®Šå­—ç¬¦æ¸¬è©¦ {i}: {char_text}")
        cleaned = cleaner.clean_text(char_text, remove_special_chars=True)
        logger.info(f"æ¸…ç†å¾Œ: {cleaned}")


def test_performance():
    """æ¸¬è©¦æ€§èƒ½"""
    import time
    
    cleaner = TextCleaner()
    
    logger.info("\n=== æ€§èƒ½æ¸¬è©¦ ===")
    
    # é•·æ–‡æœ¬æ¸¬è©¦
    long_text = "ğŸ§ " * 1000 + "AIæŠ€è¡“ç™¼å±•" * 500 + "ğŸ”¥ " * 1000
    
    start_time = time.time()
    cleaned = cleaner.clean_text(long_text)
    end_time = time.time()
    
    logger.info(f"é•·æ–‡æœ¬æ¸…ç†æ™‚é–“: {end_time - start_time:.4f} ç§’")
    logger.info(f"åŸå§‹é•·åº¦: {len(long_text)}")
    logger.info(f"æ¸…ç†å¾Œé•·åº¦: {len(cleaned)}")


def main():
    """ä¸»å‡½æ•¸"""
    logger.info("é–‹å§‹æ–‡æœ¬æ¸…ç†åŠŸèƒ½æ¸¬è©¦")
    
    try:
        # åŸºæœ¬åŠŸèƒ½æ¸¬è©¦
        test_text_cleaning()
        
        # ç‰¹å®šè¡¨æƒ…ç¬¦è™Ÿæ¸¬è©¦
        test_specific_emojis()
        
        # ç‰¹æ®Šå­—ç¬¦æ¸¬è©¦
        test_special_characters()
        
        # æ€§èƒ½æ¸¬è©¦
        test_performance()
        
        logger.info("\n=== æ‰€æœ‰æ¸¬è©¦å®Œæˆ ===")
        
    except Exception as e:
        logger.error(f"æ¸¬è©¦éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤: {e}")


if __name__ == "__main__":
    main() 