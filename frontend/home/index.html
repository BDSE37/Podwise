<!DOCTYPE HTML>

<html>

<head>
	<title>PodWise Podcast自動摘要與個人化推薦系統</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<link rel="stylesheet" href="assets/css/main.css" />

	<style>
		/* —— Step 4：亂碼顯示與複製 —— */
		#popup-step-4 {
			display: none;
			text-align: left;
		}

		#popup-step-4 h2 {
			color: #583e3d;
			font-size: 1.8em;
			margin-bottom: 1em;
		}

		#popup-step-4 .code-block-container {
			display: flex;
			align-items: flex-start;
			gap: 8px;
			margin-bottom: 1.5em;
		}

		#popup-step-4 pre#generated-code {
			background: #f5f5f5;
			padding: 1em;
			border-radius: 4px;
			font-family: monospace;
			font-size: 0.9em;
			white-space: pre-wrap;
			word-break: break-all;
			flex: 1;
			max-height: 150px;
			overflow: auto;
			border: 1px solid rgba(210, 215, 217, 0.75);
		}

		#popup-step-4 button#copy-code-btn {
			background-color: #d7b590;
			color: #fff;
			border: none;
			border-radius: 4px;
			padding: 0.6em 1.2em;
			font-size: 0.9em;
			cursor: pointer;
			transition: transform 0.1s ease;
		}

		#popup-step-4 button#copy-code-btn:active {
			transform: scale(0.95);
		}
		.music-cards {
			display: flex;
			gap: 2em;
			margin-top: 2em;
		}
		.music-card {
			background: #ebebeb;
			border-radius: 1em;
			box-shadow: 0 4px 16px rgba(88,62,61,0.08);
			width: 220px;
			overflow: hidden;
			transition: box-shadow 0.2s;
		}
		.music-card:hover {
			box-shadow: 0 8px 24px rgba(88,62,61,0.18);
		}
		.music-card-img {
			position: relative;
			width: 100%;
			height: 180px;
			overflow: hidden;
		}
		.music-card-img img {
			width: 100%;
			height: 100%;
			object-fit: cover;
		}
		.play-btn {
			position: absolute;
			bottom: 12px;
			right: 12px;
			background: rgba(215,181,144,0.9);
			border: none;
			border-radius: 50%;
			width: 44px;
			height: 44px;
			font-size: 1.5em;
			color: #fff;
			cursor: pointer;
			box-shadow: 0 2px 8px rgba(88,62,61,0.15);
			transition: background 0.2s;
		}
		.play-btn:hover {
			background: #583e3d;
		}
		.music-card-info {
			padding: 1em;
			text-align: left;
		}
		.music-card-title {
			font-weight: bold;
			font-size: 1.1em;
			color: #583e3d;
		}
		.music-card-author {
			color: #a08c7d;
			font-size: 0.95em;
			margin-top: 0.3em;
		}
		header.major {
			text-align: center;
		}
		.music-cards,
		.quiz-recommendations {
			display: flex;
			justify-content: center;
			align-items: flex-start;
			gap: 2em;
			flex-wrap: wrap;
		}

		header.major h2 { 
  color: inherit; 
}

/* 只把前面的 dash 設為白色 */
header.major .dash {
  color: #fff;
}

.searchbar-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px; /* 控制間距，可調整 */
  width: 100%;
  margin-top: 1em;
}

.InputContainer {
  display: flex;
  align-items: center;
  /* 其他原有樣式不變 */
}

.input-logo {
  height: 38px;
  width: 38px;
  cursor: pointer;
  transition: filter 0.2s;
  vertical-align: middle;
}
.input-logo:hover {
  filter: brightness(0.8);
}

/* 新增 TAG 按鈕樣式：這裡只保留純 CSS，不要有 JS */
	</style>
</head>

<body class="is-preload">

	<!-- Wrapper -->
	<div id="wrapper">

		<!-- Main -->
		<div id="main">
			<div class="inner">

				<!-- Header -->
				<header id="header" style="display: flex; justify-content: space-between; align-items: center; 
				padding: 10px 30px; width: 100%; box-sizing: border-box; margin-top: 40px;margin-bottom: 60px;">
				<!-- 左側：logo + 文字 -->
				<a href="podri.html" class="logo" style="display: flex; align-items: center; text-decoration: none;">
				  <img src="images/logo_black.png" alt="PodWise Logo" style="height: 60px; margin-right: 10px;">
				  <strong>PodWise</strong> Podcast自動摘要與個人化推薦系統
				</a>
				<!-- 右側：使用者頭像 -->
				<div>
				  <img src="images/user.png" id="user-login-btn" alt="登入"
					style="width:40px; height:40px; cursor:pointer; border-radius:50%; border:2px solid #1dd195; background:#fff; box-shadow:0 2px 8px rgba(0,0,0,0.08);">
				</div>
				<!-- 登入彈窗 -->
				<div id="login-modal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.18); z-index:9999;">
					<div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; border-radius:16px; box-shadow:0 8px 32px rgba(0,0,0,0.18); padding:2em 2.5em; min-width:260px;">
						<div style="text-align:center; margin-bottom:1em; font-weight:bold; font-size:1.1em;">請輸入使用者ID</div>
						<input type="text" id="user-id-input" placeholder="TYPE YOUR ID" style="width:100%; padding:0.7em; border-radius:8px; border:1px solid #1dd195; margin-bottom:1em; text-align:center; font-size:1em;">
						<div id="login-close-btn" style="position:absolute; top:10px; right:14px; font-size:1.3em; color:#aaa; cursor:pointer;">&times;</div>
					</div>
				</div>
					<!-- <ul class="icons">
						<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
						<li><a href="#" class="icon brands fa-snapchat-ghost"><span class="label">Snapchat</span></a>
						</li>
						<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
						<li><a href="#" class="icon brands fa-medium-m"><span class="label">Medium</span></a></li>
					</ul> -->
				</header>

				<!-- Banner -->
				<section id="banner">
					<div class="content">
						<header>
							<h1>PodWise<br /></h1>
							<h2>AI 精準調頻，打造你的個人聲音空間。</h2>
							<p> PodWise希望成為你的智能嚮導,幫助你發現符合你聆聽習慣的專屬精彩內容。</p>
							<p>讓每一次收聽,都更貼近你的需求。
							</p>
						</header>
<!-- 搜尋欄置中外層 -->
<div class="searchbar-row">
  <div class="InputContainer">
    <input placeholder="Ask Podri.." id="input" class="input" name="text" type="text">
  </div>
</div>

<script>
// 搜尋欄 Enter 鍵跳轉功能
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('input');
    
    if (searchInput) {
        searchInput.addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                const searchText = this.value.trim();
                if (searchText) {
                    // 跳轉到 podri.html 並帶入搜尋文字參數
                    window.location.href = `podri.html?search=${encodeURIComponent(searchText)}`;
                }
            }
        });
    }
});
// 登入彈窗互動
(function(){
	const loginBtn = document.getElementById('user-login-btn');
	const loginModal = document.getElementById('login-modal');
	const closeBtn = document.getElementById('login-close-btn');
	const userIdInput = document.getElementById('user-id-input');

	if(loginBtn && loginModal) {
		loginBtn.onclick = function(e) {
			loginModal.style.display = 'block';
			userIdInput.value = '';
			userIdInput.focus();
			e.stopPropagation();
		};
	}
	if(closeBtn && loginModal) {
		closeBtn.onclick = function() {
			loginModal.style.display = 'none';
		};
	}
	if(loginModal) {
		loginModal.onclick = function(e) {
			if(e.target === loginModal) loginModal.style.display = 'none';
		};
	}
	if(userIdInput) {
		userIdInput.addEventListener('keydown', function(e){
			if(e.key === 'Enter') {
				alert('已輸入ID：' + userIdInput.value);
				loginModal.style.display = 'none';
			}
		});
	}
})();
</script>


				<!-- Section -->
				<section>
					<header class="major">
						<h2 style="margin-top:6em; text-align:center;">
						  <span class="dash">--</span>熱門推薦
						</h2>
					  </header>
					  
					<div class="music-cards">
						<!-- 卡片1 -->
<div class="card">
	<div class="one">
	  <div class="music">
		<svg
		  viewBox="0 0 16 16"
		  class="note bi bi-music-note"
		  fill="currentColor"
		  height="18"
		  width="18"
		  xmlns="http://www.w3.org/2000/svg"
		>
		  <path
			d="M9 13c0 1.105-1.12 2-2.5 2S4 14.105 4 13s1.12-2 2.5-2 2.5.895 2.5 2z"
		  ></path>
		  <path d="M9 3v10H8V3h1z" fill-rule="evenodd"></path>
		  <path
			d="M8 2.82a1 1 0 0 1 .804-.98l3-.6A1 1 0 0 1 13 2.22V4L8 5V2.82z"
		  ></path>
		</svg>
	  </div>
	  <span class="name"
		><div></div>
		One piece first ending</span
	  >
	  <span class="name1"
		><div></div>
		Desconhecido</span
	  >
	  <div class="bar">
		<svg
		  viewBox="0 0 16 16"
		  class="color bi bi-fast-forward-fill"
		  fill="currentColor"
		  height="16"
		  width="16"
		  xmlns="http://www.w3.org/2000/svg"
		>
		  <path
			d="M7.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
		  ></path>
		  <path
			d="M15.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C8.713 12.69 8 12.345 8 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
		  ></path>
		</svg>
		<svg
		  viewBox="0 0 16 16"
		  class="color bi bi-caret-right-fill"
		  fill="currentColor"
		  height="18"
		  width="18"
		  xmlns="http://www.w3.org/2000/svg"
		>
		  <path
			d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"
		  ></path>
		</svg>
		<svg
		  viewBox="0 0 16 16"
		  class="color bi bi-fast-forward-fill"
		  fill="currentColor"
		  height="16"
		  width="16"
		  xmlns="http://www.w3.org/2000/svg"
		>
		  <path
			d="M7.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
		  ></path>
		  <path
			d="M15.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C8.713 12.69 8 12.345 8 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
		  ></path>
		</svg>
	  </div>

	</div>
	<div class="two"></div>
	<div class="three"></div>
  </div>
						<!-- 卡片2 -->
						<div class="card">
							<div class="one">
							  <div class="music">
								<svg
								  viewBox="0 0 16 16"
								  class="note bi bi-music-note"
								  fill="currentColor"
								  height="18"
								  width="18"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="M9 13c0 1.105-1.12 2-2.5 2S4 14.105 4 13s1.12-2 2.5-2 2.5.895 2.5 2z"
								  ></path>
								  <path d="M9 3v10H8V3h1z" fill-rule="evenodd"></path>
								  <path
									d="M8 2.82a1 1 0 0 1 .804-.98l3-.6A1 1 0 0 1 13 2.22V4L8 5V2.82z"
								  ></path>
								</svg>
							  </div>
							  <span class="name"
								><div></div>
								One piece first ending</span
							  >
							  <span class="name1"
								><div></div>
								Desconhecido</span
							  >
							  <div class="bar">
								<svg
								  viewBox="0 0 16 16"
								  class="color bi bi-fast-forward-fill"
								  fill="currentColor"
								  height="16"
								  width="16"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="M7.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								  <path
									d="M15.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C8.713 12.69 8 12.345 8 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								</svg>
								<svg
								  viewBox="0 0 16 16"
								  class="color bi bi-caret-right-fill"
								  fill="currentColor"
								  height="18"
								  width="18"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"
								  ></path>
								</svg>
								<svg
								  viewBox="0 0 16 16"
								  class="color bi bi-fast-forward-fill"
								  fill="currentColor"
								  height="16"
								  width="16"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="M7.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								  <path
									d="M15.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C8.713 12.69 8 12.345 8 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								</svg>
							  </div>
						
							</div>
							<div class="two"></div>
							<div class="three"></div>
						  </div>
<!-- 卡片2 -->
						<div class="card">
							<div class="one">
							  <div class="music">
								<svg
								  viewBox="0 0 16 16"
								  class="note bi bi-music-note"
								  fill="currentColor"
								  height="18"
								  width="18"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="M9 13c0 1.105-1.12 2-2.5 2S4 14.105 4 13s1.12-2 2.5-2 2.5.895 2.5 2z"
								  ></path>
								  <path d="M9 3v10H8V3h1z" fill-rule="evenodd"></path>
								  <path
									d="M8 2.82a1 1 0 0 1 .804-.98l3-.6A1 1 0 0 1 13 2.22V4L8 5V2.82z"
								  ></path>
								</svg>
							  </div>
							  <span class="name"
								><div></div>
								One piece first ending</span
							  >
							  <span class="name1"
								><div></div>
								Desconhecido</span
							  >
							  <div class="bar">
								<svg
								  viewBox="0 0 16 16"
								  class="color bi bi-fast-forward-fill"
								  fill="currentColor"
								  height="16"
								  width="16"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="M7.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								  <path
									d="M15.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C8.713 12.69 8 12.345 8 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								</svg>
								<svg
								  viewBox="0 0 16 16"
								  class="color bi bi-caret-right-fill"
								  fill="currentColor"
								  height="18"
								  width="18"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"
								  ></path>
								</svg>
								<svg
								  viewBox="0 0 16 16"
								  class="color bi bi-fast-forward-fill"
								  fill="currentColor"
								  height="16"
								  width="16"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="M7.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								  <path
									d="M15.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C8.713 12.69 8 12.345 8 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								</svg>
							  </div>
						
							</div>
							<div class="two"></div>
							<div class="three"></div>
						  </div>
<!-- 卡片2 -->
						<div class="card">
							<div class="one">
							  <div class="music">
								<svg
								  viewBox="0 0 16 16"
								  class="note bi bi-music-note"
								  fill="currentColor"
								  height="18"
								  width="18"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="M9 13c0 1.105-1.12 2-2.5 2S4 14.105 4 13s1.12-2 2.5-2 2.5.895 2.5 2z"
								  ></path>
								  <path d="M9 3v10H8V3h1z" fill-rule="evenodd"></path>
								  <path
									d="M8 2.82a1 1 0 0 1 .804-.98l3-.6A1 1 0 0 1 13 2.22V4L8 5V2.82z"
								  ></path>
								</svg>
							  </div>
							  <span class="name"
								><div></div>
								One piece first ending</span
							  >
							  <span class="name1"
								><div></div>
								Desconhecido</span
							  >
							  <div class="bar">
								<svg
								  viewBox="0 0 16 16"
								  class="color bi bi-fast-forward-fill"
								  fill="currentColor"
								  height="16"
								  width="16"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="M7.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								  <path
									d="M15.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C8.713 12.69 8 12.345 8 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								</svg>
								<svg
								  viewBox="0 0 16 16"
								  class="color bi bi-caret-right-fill"
								  fill="currentColor"
								  height="18"
								  width="18"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"
								  ></path>
								</svg>
								<svg
								  viewBox="0 0 16 16"
								  class="color bi bi-fast-forward-fill"
								  fill="currentColor"
								  height="16"
								  width="16"
								  xmlns="http://www.w3.org/2000/svg"
								>
								  <path
									d="M7.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								  <path
									d="M15.596 7.304a.802.802 0 0 1 0 1.392l-6.363 3.692C8.713 12.69 8 12.345 8 11.692V4.308c0-.653.713-.998 1.233-.696l6.363 3.692Z"
								  ></path>
								</svg>
							  </div>
						
							</div>
							<div class="two"></div>
							<div class="three"></div>
						  </div>

					</div>
					<audio id="audio-player"></audio>
				</section>
			</div>
		</div>
		<!--sidebay-->
	</div>
	
	<!-- Scripts -->
	<script>
		window.addEventListener('DOMContentLoaded', () => {
			// 第一次造訪才顯示 popup
			const hasVisited = localStorage.getItem('hasVisitedPopup');

			if (!hasVisited) {
				document.getElementById('popup-overlay').style.display = 'flex';
				localStorage.setItem('hasVisitedPopup', 'true');
			}
		});

		function closePopup() {
			document.getElementById("popup-overlay").style.display = "none";
		}
	</script>

	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/browser.min.js"></script>
	<script src="assets/js/breakpoints.min.js"></script>
	<script src="assets/js/util.js"></script>
	<script src="assets/js/main.js"></script>

	<!-- Quiz Overlay -->
	<div id="popup-overlay"
		style="display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9999; display:flex; justify-content:center; align-items:center;">
		<div id="popup-container"
			style="background:#ebebeb; padding:2.5em; border-radius:2em; max-width:600px; width:90%; position:relative;">
			<!-- 關閉按鈕 -->
			<img src="images/delete.png" alt="關閉" class="close-button"
				style="position:absolute; top:1rem; right:1rem; width:24px; height:24px; cursor:pointer; z-index:10;"
				onclick="closePopup()">
			<!-- Step 1 -->
			<div class="popup-step" id="popup-step-1">
				<h2>Taste of PodWise !</h2>
				<div class="quiz-option-container">
					<div class="quiz-option" onclick="selectMainCategory('business')">
						<img src="images/financial-profit_golden.png" alt="商業">
						<div>商業</div>
					</div>
					<div class="quiz-option" onclick="selectMainCategory('education')">
						<img src="images/school_golden.png" alt="教育">
						<div>教育</div>
					</div>
				</div>
			</div>

			<!-- Step 2 -->
			<div class="popup-step" id="popup-step-2" style="display:none;">
				<h2>Which type?</h2>
				<div id="category-tags" style="display: flex; gap: 1em; margin-bottom: 1.5em;"></div>
				<div class="quiz-type-container">
					<button class="quiz-type-btn" onclick="selectCategory(this, '財經')">財經</button>
					<button class="quiz-type-btn" onclick="selectCategory(this, '職業')">職業</button>
					<button class="quiz-type-btn" onclick="selectCategory(this, '房地產')">房地產</button>
					<button class="quiz-type-btn" onclick="selectCategory(this, '行銷')">行銷</button>
					<button class="quiz-type-btn" onclick="selectCategory(this, '教育')">教育</button>
					<button class="quiz-type-btn" onclick="selectCategory(this, '學習')">學習</button>
					<button class="quiz-type-btn" onclick="selectCategory(this, '知識')">知識</button>
					<button class="quiz-type-btn" onclick="selectCategory(this, '技能')">技能</button>
				</div>
				<button class="button primary" style="margin-top:2em;" onclick="goToStep(3)">下一步</button>
			</div>
			
			<script>
				let mainCategory = '';
				
				function selectMainCategory(category) {
					mainCategory = category;
					goToStep(2);
				}
				
				function selectCategory(button, category) {
					// 移除所有按鈕的選中狀態
					document.querySelectorAll('.quiz-type-btn').forEach(btn => {
						btn.classList.remove('selected');
					});
					
					// 添加選中狀態到當前按鈕
					button.classList.add('selected');
					
					// 儲存選中的類別
					window.selectedCategory = category;
					window.selectedTag = null; // 切換主類別時清空已選 TAG
					renderCategoryTags(); // 重新渲染 TAGs
				}
				
				// 在 goToStep 函數中添加顯示對應選項的邏輯
				function goToStep(step) {
					// 隱藏所有步驟
					document.querySelectorAll('.popup-step').forEach(s => s.style.display = 'none');
					
					// 顯示指定步驟
					document.getElementById(`popup-step-${step}`).style.display = 'block';
					
					// 如果是 Step 2，渲染 TAGs
					if (step === 2) {
						renderCategoryTags();
					}
					
					// 如果是 Step 3，載入推薦
					if (step === 3) {
						loadRecommendations();
					}
				}
			</script>

<!-- Step 3 -->
<div class="popup-step" id="popup-step-3" style="display:none;">
	<h2>You may like…</h2>
	<h3 style="text-align:left; margin-left:0; padding-left:0;">
	  試聽你有興趣的節目 並按下喜歡
	</h3>
	<div class="quiz-recommendations" id="recommendations-container" style="display: flex; gap: 1.5em; flex-wrap: wrap; justify-content: center; align-items: center;">
	  <!-- 推薦節目將在這裡動態載入 -->
	  </div>
  
	<button class="button secondary" onclick="refreshRecommendations()">重新整理</button>
	<button class="button primary" onclick="goToStep(4)">下一步</button>
  
	<script>
	  // 全域變數
	  let currentCategory = '';
	  let selectedEpisodes = [];
	  let currentRecommendations = [];
	  
	  // 主類別對應 TAG pool（與後端一致）
	  const CATEGORY_TAGS = {
		business: ["投資理財", "股票分析", "房地產", "創業"],
		education: ["學習方法", "教育理念", "知識分享", "個人成長"]
	  };
	  
	  window.selectedTag = null;
	  
	  // 渲染 Step 2 的 TAG 按鈕
	  function renderCategoryTags() {
		const tagDiv = document.getElementById('category-tags');
		tagDiv.innerHTML = '';
		const apiCategory = mapCategoryToAPI(getCategoryFromStep2());
		const tags = CATEGORY_TAGS[apiCategory] || [];
		tags.forEach(tag => {
		  const btn = document.createElement('button');
		  btn.className = 'tag-btn' + (window.selectedTag === tag ? ' selected' : '');
		  btn.textContent = tag;
		  btn.onclick = function() {
			window.selectedTag = tag;
			renderCategoryTags(); // 重新渲染高亮
		  };
		  tagDiv.appendChild(btn);
		});
	  }
	  
	  // 從 Step 2 獲取類別
	  function getCategoryFromStep2() {
		// 首先檢查全域變數
		if (window.selectedCategory) {
		  console.log('使用全域變數 selectedCategory:', window.selectedCategory);
		  return window.selectedCategory;
		}
		
		// 如果全域變數沒有，則檢查 DOM
		const categoryButtons = document.querySelectorAll('.quiz-type-btn');
		for (let btn of categoryButtons) {
		  if (btn.classList.contains('selected')) {
			const category = btn.textContent.trim();
			console.log('從 DOM 獲取類別:', category);
			return category;
		  }
		}
		console.log('沒有找到選中的類別，使用預設值: business');
		return 'business'; // 預設值
	  }
	  
	  // 映射類別到 API 類別
	  function mapCategoryToAPI(category) {
		const categoryMap = {
		  '財經': 'business',
		  '職業': 'business', 
		  '房地產': 'business',
		  '行銷': 'business',
		  '投資': 'business',
		  '理財': 'business',
		  '教育': 'education',
		  '學習': 'education',
		  '知識': 'education',
		  '技能': 'education'
		};
		return categoryMap[category] || 'business';
	  }
	  
	  // 載入推薦節目
	  async function loadRecommendations() {
		try {
		  currentCategory = getCategoryFromStep2();
		  const apiCategory = mapCategoryToAPI(currentCategory);
		  const tag = window.selectedTag;
		  const response = await fetch('http://localhost:8006/api/category/recommendations', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify({ category: apiCategory, tag: tag })
		  });
		  if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
		  const data = await response.json();
		  currentRecommendations = data.recommendations || [];
		  renderRecommendations();
		} catch (error) {
		  console.error('載入推薦失敗:', error);
		  loadDefaultRecommendations();
		}
	  }
	  
	  // 載入預設推薦（當 API 不可用時）
	  function loadDefaultRecommendations() {
		const defaultRecommendations = [
		  {
			podcast_name: '股癌 Gooaye',
			episode_title: '投資理財精選',
			episode_description: '晦澀金融投資知識直白講，重要海內外時事輕鬆談。',
			podcast_image: 'images/股癌.png',
			audio_url: 'audio/sample1.mp3',
			episode_id: 1,
			rss_id: '123',
			tags: ['投資理財', '股票分析', '市場趨勢', '經濟分析']
		  },
		  {
			podcast_name: '矽谷輕鬆談',
			episode_title: 'AI 技術趨勢',
			episode_description: 'Google 搜尋、AI 技術、科技趨勢都能輕鬆聽懂。',
			podcast_image: 'images/矽谷輕鬆談.png',
			audio_url: 'audio/sample2.mp3',
			episode_id: 2,
			rss_id: '456',
			tags: ['科技趨勢', '人工智慧', '創新思維', '數位轉型']
		  },
		  {
			podcast_name: '天下學習',
			episode_title: '管理思維分享',
			episode_description: '訪談頂尖領導者，探索管理思維、教育創新與未來趨勢。',
			podcast_image: 'images/天下學習.png',
			audio_url: 'audio/sample3.mp3',
			episode_id: 3,
			rss_id: '789',
			tags: ['企業管理', '領導力', '學習方法', '個人成長']
		  }
		];
  
		currentRecommendations = defaultRecommendations;
		renderRecommendations();
	  }
	  
	  // 渲染推薦節目
	  function renderRecommendations() {
		const container = document.getElementById('recommendations-container');
		container.innerHTML = '';
  
		currentRecommendations.forEach((rec, index) => {
		  const rssId = rec.rss_id;
		  const playBtnId = `play-btn-${index}`;
		  const imgId = `podcast-img-${index}`;
		  
		  // 調試：檢查每個推薦的 tags
		  console.log(`渲染推薦 ${index + 1}:`, {
			rec_tags: rec.tags,
			rec_tags_type: typeof rec.tags,
			rec_tags_length: rec.tags ? rec.tags.length : 0,
			tags_condition: rec.tags ? '有 tags' : '無 tags',
			tags_is_array: Array.isArray(rec.tags),
			tags_map_result: rec.tags ? rec.tags.map(tag => tag).join(', ') : '無 tags'
		  });
		  // 圖片佔位
		  const imgHtml = `<img id="${imgId}" alt="${rec.podcast_name}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px;">`;
		  
		  const item = document.createElement('div');
		  item.className = 'recommend-item';
		  item.innerHTML = `
			${imgHtml}
			<img src="images/play_gray.png" alt="播放" class="play-button" id="${playBtnId}" style="cursor:pointer; width:44px; height:44px;" onclick="playOrPauseAudio(this, '${rec.rss_id}', '${rec.episode_title}', '${rec.category || ''}')">
		<div class="text">
			  <div class="title">${rec.podcast_name}</div>
			  <p class="description">${rec.episode_title}</p>
			  <div class="tags-container" style="margin-top: 8px; border: 1px solid red; padding: 4px;">
				${rec.tags ? rec.tags.map(tag => `<span class="tag" style="display: inline-block; background: #f0f0f0; color: #666; padding: 2px 6px; margin: 2px; border-radius: 12px; font-size: 11px;">${tag}</span>`).join('') : '<span style="color: red;">無 tags 可顯示</span>'}
		</div>
			</div>
			<div class="heart-container" title="Like" onclick="toggleLike(${index}, ${rec.episode_id}, '${rec.podcast_name}', '${rec.episode_title}', '${rec.rss_id}')">
			  <input type="checkbox" class="checkbox" id="like-${index}">
		  <div class="svg-container">
			<svg viewBox="0 0 24 24" class="svg-outline" xmlns="http://www.w3.org/2000/svg">
				  <path d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Zm-3.585,18.4a2.973,2.973,0,0,1-3.83,0C4.947,16.006,2,11.87,2,8.967a4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,11,8.967a1,1,0,0,0,2,0,4.8,4.8,0,0,1,4.5-5.05A4.8,4.8,0,0,1,22,8.967C22,11.87,19.053,16.006,13.915,20.313Z"></path>
			</svg>
			<svg viewBox="0 0 24 24" class="svg-filled" xmlns="http://www.w3.org/2000/svg">
				  <path d="M17.5,1.917a6.4,6.4,0,0,0-5.5,3.3,6.4,6.4,0,0,0-5.5-3.3A6.8,6.8,0,0,0,0,8.967c0,4.547,4.786,9.513,8.8,12.88a4.974,4.974,0,0,0,6.4,0C19.214,18.48,24,13.514,24,8.967A6.8,6.8,0,0,0,17.5,1.917Z"></path>
			</svg>
			<svg class="svg-celebrate" width="100" height="100" xmlns="http://www.w3.org/2000/svg">
			  <polygon points="10,10 20,20"></polygon>
			  <polygon points="10,50 20,50"></polygon>
			  <polygon points="20,80 30,70"></polygon>
			  <polygon points="90,10 80,20"></polygon>
			  <polygon points="90,50 80,50"></polygon>
			  <polygon points="80,80 70,70"></polygon>
			</svg>
		  </div>
		</div>
		  `;
		  container.appendChild(item);
		  
		  // 強制設置 checkbox 為未選中狀態
		  const checkbox = document.getElementById(`like-${index}`);
		  if (checkbox) {
			checkbox.checked = false;
			checkbox.removeAttribute('checked');
		  }
		  
		  // 動態載入圖片
		  setPodcastImage(document.getElementById(imgId), rssId);
		});
	  }
	  
	  // 設定節目圖片（從 MinIO 載入）
	  function setPodcastImage(imgElement, rssId) {
		if (!imgElement || !rssId) {
		  console.error('setPodcastImage: 缺少必要參數', { imgElement, rssId });
		  return;
		}
		
		console.log('開始載入圖片，RSS ID:', rssId);
		
		// 嘗試從 MinIO 載入圖片
		const sizes = ['300', '640', '64'];
		let currentSizeIndex = 0;
		
		function tryNextSize() {
		  if (currentSizeIndex >= sizes.length) {
			// 所有尺寸都失敗，使用預設圖片
			console.log('所有圖片尺寸都失敗，使用預設圖片');
			imgElement.src = 'images/default_podcast.png';
			return;
		  }
		  
		  const size = sizes[currentSizeIndex];
		  // 使用 MinIO 預簽名 URL 格式
		  const imageUrl = `http://localhost:9000/podcast-images/RSS_${rssId}_${size}.jpg`;
		  
		  console.log(`嘗試載入圖片: ${imageUrl}`);
		  
		  // 測試圖片是否可載入
		  const testImg = new Image();
		  testImg.onload = function() {
			console.log(`成功載入圖片: ${imageUrl}`);
			imgElement.src = imageUrl;
		  };
		  testImg.onerror = function() {
			console.log(`圖片載入失敗: ${imageUrl}`);
			currentSizeIndex++;
			tryNextSize();
		  };
		  testImg.src = imageUrl;
		}
		
		tryNextSize();
	  }
	  
	  let globalAudio = null;
	  let currentPlayButton = null;
	  let lastAudioUrl = '';
	  let lastAudioTime = 0;

	  // 修正 1: playOrPauseAudio 暫停/播放切換
	  async function playOrPauseAudio(button, rssId, episodeTitle, category) {
		try {
		  console.log('playOrPauseAudio 被呼叫:', { rssId, episodeTitle, category });
		  console.log('當前按鈕狀態:', button.src);
		  console.log('globalAudio 狀態:', globalAudio ? (globalAudio.paused ? 'paused' : 'playing') : 'null');

		  // 檢查是否為同一首歌曲的暫停/播放切換
		  const apiCategory = mapCategoryToAPI(currentCategory);
		  const response = await fetch('http://localhost:8006/api/audio/stream', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' },
			body: JSON.stringify({ rss_id: rssId, episode_title: episodeTitle, category: apiCategory })
		  });
		  if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
		  const data = await response.json();
		  const audioUrl = data.audio_url;
		  if (!audioUrl) throw new Error('無法獲取音檔 URL');

		  // 如果已經有 audio 物件且是同一首歌曲
		  if (globalAudio && lastAudioUrl === audioUrl) {
			if (!globalAudio.paused) {
			  // 正在播放，執行暫停
			  console.log('執行暫停');
			  globalAudio.pause();
			  lastAudioTime = globalAudio.currentTime;
			  button.src = 'images/play_gray.png';
			  return;
			} else {
			  // 已暫停，執行播放
			  console.log('執行播放');
			  globalAudio.currentTime = lastAudioTime;
			  globalAudio.play();
			  button.src = 'images/stop_gray.png';
			  return;
			}
		  }

		  // 如果是新歌曲或沒有 audio 物件，先停止當前播放
		  if (globalAudio) {
			console.log('停止當前播放，切換到新歌曲');
			globalAudio.pause();
			if (currentPlayButton && currentPlayButton !== button) {
			  currentPlayButton.src = 'images/play_gray.png';
			}
		  }

		  // 建立新的 audio 物件
		  console.log('建立新音檔物件');
		  globalAudio = new Audio(audioUrl);
		  lastAudioUrl = audioUrl;
		  lastAudioTime = 0;
		  currentPlayButton = button;

		  // 設定事件監聽器
		  globalAudio.addEventListener('ended', () => {
			console.log('播放結束');
			button.src = 'images/play_gray.png';
			lastAudioTime = 0;
		  });
		  
		  globalAudio.addEventListener('pause', () => {
			console.log('暫停事件觸發');
			button.src = 'images/play_gray.png';
		  });
		  
		  globalAudio.addEventListener('play', () => {
			console.log('播放事件觸發');
			button.src = 'images/stop_gray.png';
		  });
		  
		  globalAudio.addEventListener('error', (e) => {
			console.log('播放錯誤:', e);
			button.src = 'images/play_gray.png';
			alert('音檔播放失敗');
		  });

		  // 開始播放
		  console.log('開始播放新歌曲');
		  await globalAudio.play();
		  button.src = 'images/stop_gray.png';

		} catch (error) {
		  console.error('播放失敗:', error);
		  button.src = 'images/play_gray.png';
		  alert('播放失敗: ' + error.message);
		}
	  }
	  
	  // 播放音檔
	  async function playAudio(audioUrl, episodeId, podcastName, episodeTitle, rssId) {
		try {
		  console.log('開始播放音檔:', audioUrl);
		  
		  // 檢查是否為 MinIO 音檔 URL
		  let finalAudioUrl = audioUrl;
		  
		  // 如果 URL 不包含 localhost:9000（MinIO 預簽名 URL），則嘗試獲取
		  if (!audioUrl.includes('localhost:9000') && !audioUrl.includes('audio/sample')) {
			try {
			  const response = await fetch('http://localhost:8006/api/audio/stream', {
				method: 'POST',
				headers: {
				  'Content-Type': 'application/json',
				},
				body: JSON.stringify({
				  rss_id: rssId,
				  episode_title: episodeTitle,
				  category: mapCategoryToAPI(currentCategory)
				})
			  });
			  
			  if (response.ok) {
				const data = await response.json();
				if (data.audio_url) {
				  finalAudioUrl = data.audio_url;
				  console.log('從 MinIO 獲取音檔:', finalAudioUrl);
				}
			  }
			} catch (error) {
			  console.log('無法從 MinIO 獲取音檔，使用預設音檔');
			}
		  }
		  
		  // 停止當前播放的音檔
		  const existingAudio = document.getElementById('audio-player');
		  if (existingAudio) {
			existingAudio.pause();
			existingAudio.currentTime = 0;
		  }
		  
		  // 創建新的音檔元素
		  const audio = new Audio();
		  audio.id = 'audio-player';
		  audio.src = finalAudioUrl;
		  
		  // 添加播放事件監聽器
		  audio.addEventListener('loadstart', () => {
			console.log('開始載入音檔...');
		  });
		  
		  audio.addEventListener('canplay', () => {
			console.log('音檔可以播放');
		  });
		  
		  audio.addEventListener('play', () => {
			console.log('開始播放:', podcastName, '-', episodeTitle);
			// 顯示播放狀態
			showPlayStatus(podcastName, episodeTitle, true);
		  });
		  
		  audio.addEventListener('ended', () => {
			console.log('播放結束');
			showPlayStatus(podcastName, episodeTitle, false);
		  });
		  
		  audio.addEventListener('error', (e) => {
			console.error('播放錯誤:', e);
			alert('音檔播放失敗，請檢查音檔是否存在');
			showPlayStatus(podcastName, episodeTitle, false);
		  });
		  
		  // 開始播放
		  const playPromise = audio.play();
		  if (playPromise !== undefined) {
			playPromise.then(() => {
			  // 播放成功
			  console.log('播放成功啟動');
			}).catch(error => {
			  console.error('播放失敗:', error);
			  alert('播放失敗，可能是瀏覽器阻止了自動播放');
			});
		  }
		  
		  // 記錄播放行為
		  recordFeedback('play', episodeId, podcastName, episodeTitle, rssId);
		  
		} catch (error) {
		  console.error('播放失敗:', error);
		  alert('播放失敗: ' + error.message);
		}
	  }
	  
	  // 顯示播放狀態
	  function showPlayStatus(podcastName, episodeTitle, isPlaying) {
		// 創建或更新播放狀態提示
		let statusDiv = document.getElementById('play-status');
		if (!statusDiv) {
		  statusDiv = document.createElement('div');
		  statusDiv.id = 'play-status';
		  statusDiv.style.cssText = `
			position: fixed;
			top: 20px;
			right: 20px;
			background: ${isPlaying ? '#4CAF50' : '#f44336'};
			color: white;
			padding: 10px 15px;
			border-radius: 5px;
			z-index: 10000;
			font-size: 14px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.2);
		  `;
		  document.body.appendChild(statusDiv);
		}
		
		statusDiv.textContent = isPlaying ? 
		  `🎵 正在播放: ${podcastName} - ${episodeTitle}` : 
		  `⏹️ 播放結束: ${podcastName} - ${episodeTitle}`;
		
		// 3秒後自動隱藏
		setTimeout(() => {
		  if (statusDiv && !isPlaying) {
			statusDiv.remove();
		  }
		}, 3000);
	  }
	  
	  // 切換喜歡狀態
	  function toggleLike(index, episodeId, podcastName, episodeTitle, rssId) {
		const checkbox = document.getElementById(`like-${index}`);
		const heartContainer = checkbox.closest('.heart-container');
		const isLiked = checkbox.checked;
		
		console.log('toggleLike 被呼叫:', { index, episodeId, isLiked });
		
		// 切換 checkbox 狀態
		checkbox.checked = !isLiked;
		
		// 添加愛心動畫效果
		if (!isLiked) {
		  // 喜歡動畫
		  heartContainer.style.transform = 'scale(1.2)';
		  setTimeout(() => {
			heartContainer.style.transform = 'scale(1)';
		  }, 200);
		  
		  // 顯示慶祝動畫
		  const celebrateSvg = heartContainer.querySelector('.svg-celebrate');
		  if (celebrateSvg) {
			celebrateSvg.style.display = 'block';
			celebrateSvg.style.animation = 'keyframes-svg-celebrate 0.6s ease-out';
			setTimeout(() => {
			  celebrateSvg.style.display = 'none';
			}, 600);
		  }
		}
		
		// 更新選中的節目列表
		const episodeData = {
		  episode_id: episodeId,
		  podcast_name: podcastName,
		  episode_title: episodeTitle,
		  rss_id: rssId
		};
		
		if (!isLiked) {
		  // 添加到選中列表
		  selectedEpisodes.push(episodeData);
		  recordFeedback('like', episodeId, podcastName, episodeTitle, rssId);
		  console.log(`❤️ 喜歡節目: ${podcastName} - ${episodeTitle}`);
		} else {
		  // 從選中列表移除
		  selectedEpisodes = selectedEpisodes.filter(ep => ep.episode_id !== episodeId);
		  recordFeedback('unlike', episodeId, podcastName, episodeTitle, rssId);
		  console.log(`💔 取消喜歡: ${podcastName} - ${episodeTitle}`);
		}
		
		console.log('選中的節目數量:', selectedEpisodes.length);
		console.log('選中的節目:', selectedEpisodes);
		
		// 顯示用戶偏好提示
		showPreferenceNotification(podcastName, episodeTitle, !isLiked);
	  }
	  
	  // 顯示用戶偏好提示
	  function showPreferenceNotification(podcastName, episodeTitle, isLiked) {
		// 創建或更新偏好提示
		let notificationDiv = document.getElementById('preference-notification');
		if (!notificationDiv) {
		  notificationDiv = document.createElement('div');
		  notificationDiv.id = 'preference-notification';
		  notificationDiv.style.cssText = `
			position: fixed;
			top: 80px;
			right: 20px;
			background: ${isLiked ? '#4CAF50' : '#f44336'};
			color: white;
			padding: 12px 18px;
			border-radius: 8px;
			z-index: 10000;
			font-size: 14px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.3);
			max-width: 300px;
			word-wrap: break-word;
			transform: translateX(100%);
			transition: transform 0.3s ease;
		  `;
		  document.body.appendChild(notificationDiv);
		}
		
		const emoji = isLiked ? '❤️' : '💔';
		const action = isLiked ? '已加入喜好' : '已移除喜好';
		
		notificationDiv.innerHTML = `
		  <div style="display: flex; align-items: center; gap: 8px;">
			<span style="font-size: 18px;">${emoji}</span>
			<div>
			  <div style="font-weight: bold;">${action}</div>
			  <div style="font-size: 12px; opacity: 0.9;">${podcastName}</div>
			  <div style="font-size: 11px; opacity: 0.8;">${episodeTitle}</div>
	  </div>
	</div>
  `;
		
		// 顯示動畫
		setTimeout(() => {
		  notificationDiv.style.transform = 'translateX(0)';
		}, 100);
		
		// 3秒後自動隱藏
		setTimeout(() => {
		  notificationDiv.style.transform = 'translateX(100%)';
		  setTimeout(() => {
			if (notificationDiv) {
			  notificationDiv.remove();
			}
		  }, 300);
		}, 3000);
	  }
	  
	  // 記錄用戶反饋
	  async function recordFeedback(action, episodeId, podcastName, episodeTitle, rssId) {
		try {
		  const response = await fetch('http://localhost:8007/api/feedback', {
			method: 'POST',
			headers: {
			  'Content-Type': 'application/json',
			},
			body: JSON.stringify({
			  user_id: 'temp_user', // 暫時用戶 ID
			  episode_id: episodeId,
			  podcast_name: podcastName,
			  episode_title: episodeTitle,
			  rss_id: rssId,
			  action: action,
			  category: mapCategoryToAPI(currentCategory)
			})
		  });
		  
		  if (response.ok) {
			console.log(`${action} 操作記錄成功`);
		  }
		  
		} catch (error) {
		  console.error('記錄反饋失敗:', error);
		}
	  }
	  
	  // 重新整理推薦
	  function refreshRecommendations() {
		loadRecommendations();
	  }
	  
	  // 頁面載入時載入推薦
	  document.addEventListener('DOMContentLoaded', () => {
		// 延遲載入，確保 Step 2 已完成
		setTimeout(loadRecommendations, 100);
	  });
	  
	  // 頁面離開時停止音檔播放
	  window.addEventListener('beforeunload', () => {
		if (globalAudio) {
		  globalAudio.pause();
		  globalAudio = null;
		}
	  });
	  
	  // 修正 goToStep 函數，在跳轉時停止音檔
	  function goToStep(step) {
		// 停止當前播放的音檔
		if (globalAudio) {
		  globalAudio.pause();
		  globalAudio = null;
		  if (currentPlayButton) {
			currentPlayButton.src = 'images/play_gray.png';
		  }
		}
		
		// 隱藏所有步驟
		for (let i = 1; i <= 4; i++) {
		  const el = document.getElementById(`popup-step-${i}`);
		  if (el) el.style.display = 'none';
		}
		
		// 顯示指定步驟
		const targetEl = document.getElementById(`popup-step-${step}`);
		if (targetEl) targetEl.style.display = 'block';
		
		// 如果是步驟 4，執行額外邏輯
		if (step === 4) {
		  // 這裡可以添加步驟 4 的特殊邏輯
		}
	  }
	</script>
  </div>
  
			<!-- Step 4 -->
<div class="popup-step" id="popup-step-4" style="display: none;">
  <h2 style="color: #7c4dff;">Sign in Your Podwise</h2>
  <!-- 這裡開始： -->
  <div class="form-center">
    <!-- Podwise ID 輸入 -->
    <input
      type="text"
      name="demo-name"
      id="demo-name"
      placeholder="輸入你的Podwise ID"
    />

    <!-- or 分隔 -->
    <span style="color:#666;">— or —</span>

    <!-- 產生 ID 按鈕 -->
    <input
      type="button"
      value="產生Podwise ID"
      id="generateIdBtn"
      class="secondary"
      onclick="generatePodwiseID()"
    />

    <!-- 顯示產生後的 ID -->
    <input
      type="text"
      id="podwiseIdField"
      readonly
      placeholder="Generating..."
    />

    <!-- 進入 Podwise 按鈕 -->
    <button
      type="button"
      class="button primary"
      onclick="enterPodwise()"
    >
      進入Podwise
    </button>
  </div>
  <!-- 這裡結束 -->
</div>

									<script>
										async function generatePodwiseID() {
											try {
												// 顯示載入狀態
												const idField = document.getElementById('podwiseIdField');
												const generateBtn = document.getElementById('generateIdBtn');
												
												idField.value = '正在生成...';
												generateBtn.disabled = true;
												generateBtn.value = '生成中...';
												
												// 調用後端 API 生成 Podwise ID
												const response = await fetch('/api/generate-podwise-id', {
													method: 'POST',
													headers: {
														'Content-Type': 'application/json',
													}
												});
												
												if (response.ok) {
													const data = await response.json();
													if (data.success) {
														// 顯示生成的 Podwise ID
														idField.value = data.podwise_id;
														console.log('Podwise ID 生成成功:', data.podwise_id);
													} else {
														throw new Error(data.message || '生成失敗');
													}
												} else {
													throw new Error('API 請求失敗');
												}
												
											} catch (error) {
												console.error('生成 Podwise ID 失敗:', error);
												document.getElementById('podwiseIdField').value = '生成失敗，請重試';
												alert('生成 Podwise ID 失敗，請重試');
											} finally {
												// 恢復按鈕狀態
												const generateBtn = document.getElementById('generateIdBtn');
												generateBtn.disabled = false;
												generateBtn.value = '產生Podwise ID';
											}
										}
										
										// 收集所有 Like 的節目資訊
										function collectLikedEpisodes() {
										  const likedEpisodes = [];
										  if (window.currentRecommendations) {
										    window.currentRecommendations.forEach((rec, idx) => {
										      const checkbox = document.getElementById(`like-${idx}`);
										      if (checkbox && checkbox.checked) {
										        likedEpisodes.push({
										          podcast_name: rec.podcast_name,
										          episode_title: rec.episode_title,
										          rss_id: rec.rss_id,
										          episode_id: rec.episode_id
										        });
										      }
										    });
										  }
										  window.selectedEpisodes = likedEpisodes;
										}
										
										// 進入 Podwise 按鈕觸發
										async function enterPodwise() {
										  collectLikedEpisodes(); // 先收集 Like 節目
										
										  const userIdInput = document.getElementById('demo-name');
										  const generatedIdInput = document.getElementById('podwiseIdField');
										  let userId = userIdInput.value.trim();
										  const isNewUser = generatedIdInput.value.trim() !== '';
										  if (isNewUser) {
										    userId = generatedIdInput.value.trim();
										  }
										  if (!userId) {
										    alert('請輸入或產生 Podwise ID');
										    return;
										  }
										  try {
										    if (isNewUser) {
										      await registerNewUser(userId);
										    } else {
										      const exists = await checkUserExists(userId);
										      if (!exists) {
										        await registerNewUser(userId);
										      }
										    }
										    window.location.href = 'index.html';
										  } catch (error) {
										    alert('登入失敗，請重試');
										  }
										}
										
										async function checkUserExists(userId) {
											try {
												const response = await fetch(`/api/user/check/${userId}`);
												const data = await response.json();
												return data.exists;
											} catch (error) {
												console.error('檢查用戶失敗:', error);
												return false;
											}
										}
										
										async function registerNewUser(userId) {
											try {
												const response = await fetch('/api/user/register', {
													method: 'POST',
													headers: {
														'Content-Type': 'application/json',
													},
													body: JSON.stringify({
														user_id: userId,
														category: window.selectedCategory || 'business',
														selected_episodes: window.selectedEpisodes || []
													})
												});
												
												if (response.ok) {
													console.log('用戶註冊成功');
												} else {
													throw new Error('註冊失敗');
												}
												
											} catch (error) {
												console.error('註冊用戶失敗:', error);
												throw error;
											}
										}
									</script>
						<!-- <button type="button" class="button" onclick="closePopup()">進入Podwise</button> -->
								</div>

						</div>
					</div>

					<!-- Scripts -->
					<script src="assets/js/jquery.min.js"></script>
					<script src="assets/js/browser.min.js"></script>
					<script src="assets/js/breakpoints.min.js"></script>
					<script src="assets/js/util.js"></script>
					<script src="assets/js/main.js"></script>
					<script>
						// 初次顯示
						window.addEventListener('DOMContentLoaded', () => {
							document.getElementById('popup-overlay').style.display = 'flex';
						});

						// 切換步驟（已在上方定義，這裡移除重複定義）

						// 向後端取得 ID 並顯示
						function fetchGeneratedCode() {
							fetch('/api/get-id')
								.then(res => res.text())
								.then(code => {
									document.getElementById('generated-code').textContent = code;
								})
								.catch(() => {
									document.getElementById('generated-code').textContent = '取得失敗';
								});
						}

						// 複製按鈕
						// document.addEventListener('DOMContentLoaded', () => {
						// 	document.getElementById('copy-code-btn').addEventListener('click', () => {
						// 		const code = document.getElementById('generated-code').textContent;
						// 		navigator.clipboard.writeText(code)
						// 			.then(() => alert('已複製到剪貼簿！'))
						// 			.catch(() => alert('複製失敗'));
						// 	});
						// });

						// 關閉
						function closePopup() {
							document.getElementById('popup-overlay').style.display = 'none';
						}
					</script>
        <!-- Step 4 結束 -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Footer 應該在這裡，獨立於 popup 之外 -->
<footer id="footer" style="background:#dddada; padding:2em 0; text-align:center; margin-top:3em;">
  <div class="inner">
    <p style="margin:0; color:#3d4449;">&copy; 2025 PodWise. All rights reserved.</p>
    <p style="margin:0; font-size:0.9em; color:#3d4449;">Designed by PodWise Team</p>
</footer>

</body>
</html>