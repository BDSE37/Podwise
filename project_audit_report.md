# Podwise å°ˆæ¡ˆå…¨é¢å¯©è¨ˆå ±å‘Š

## ğŸ“‹ å¯©è¨ˆæ¦‚è¿°

æœ¬å ±å‘Šå° Podwise å°ˆæ¡ˆé€²è¡Œå…¨é¢å¯©è¨ˆï¼Œç¢ºä¿ç¬¦åˆ OOP è¨­è¨ˆåŸå‰‡ã€æ²’æœ‰é‡è¤‡åŠŸèƒ½ï¼Œä¸¦ä¸” RAG Pipeline å¯ä»¥èˆ‡ podri_chat é †åˆ©æ•´åˆï¼ŒåŒæ™‚æ”¯æ´ Podman éƒ¨ç½²ã€‚

## ğŸ—ï¸ æ¶æ§‹è¨­è¨ˆè©•ä¼°

### âœ… OOP è¨­è¨ˆåŸå‰‡éµå¾ª

#### 1. **åŸºç¤æœå‹™æŠ½è±¡å±¤**
- **ä½ç½®**: `backend/core/base_service.py`
- **è¨­è¨ˆ**: ä½¿ç”¨æŠ½è±¡åŸºé¡ `BaseService` å®šç¾©æ‰€æœ‰æœå‹™çš„é€šç”¨ä»‹é¢
- **å„ªé»**: 
  - æä¾›çµ±ä¸€çš„æœå‹™ä»‹é¢
  - å¼·åˆ¶å­é¡åˆ¥å¯¦ä½œå¿…è¦æ–¹æ³•
  - æ”¯æ´ä¾è³´æ³¨å…¥å’Œæ¸¬è©¦

#### 2. **æœå‹™å±¤æ¶æ§‹**
- **LLM æœå‹™**: `backend/llm/ollama_service.py` - å®Œæ•´çš„ OOP å¯¦ä½œ
- **TTS æœå‹™**: `backend/tts/` - æ¨¡çµ„åŒ–è¨­è¨ˆ
- **STT æœå‹™**: `backend/stt/` - æœå‹™å°å‘æ¶æ§‹
- **RAG Pipeline**: `backend/rag_pipeline/core/` - åˆ†å±¤æ¶æ§‹

#### 3. **å‰ç«¯ OOP è¨­è¨ˆ**
- **PodriChatApp**: `frontend/pages/podri_chat.py` - å®Œæ•´çš„é¡åˆ¥è¨­è¨ˆ
- **ServiceManager**: `frontend/chat/services/service_manager.py` - æœå‹™ç®¡ç†
- **IntelligentProcessor**: `frontend/chat/services/intelligent_processor.py` - æ™ºèƒ½è™•ç†

### âš ï¸ éœ€è¦æ”¹é€²çš„ OOP è¨­è¨ˆ

#### 1. **é‡è¤‡çš„ DictToAttrRecursive é¡åˆ¥**
**å•é¡Œ**: åœ¨å¤šå€‹æª”æ¡ˆä¸­é‡è¤‡å®šç¾©ç›¸åŒçš„é¡åˆ¥
- `backend/tts/GPT-SoVITS/api.py` (2æ¬¡)
- `backend/tts/GPT-SoVITS/GPT_SoVITS/TTS_infer_pack/TTS.py`
- `backend/tts/GPT-SoVITS/GPT_SoVITS/export_torch_script.py`
- ç­‰å¤šå€‹æª”æ¡ˆ

**è§£æ±ºæ–¹æ¡ˆ**: 
```python
# å»ºè­°å‰µå»ºå…±ç”¨å·¥å…·æ¨¡çµ„
# backend/utils/common_utils.py
class DictToAttrRecursive(dict):
    """çµ±ä¸€çš„å­—å…¸åˆ°å±¬æ€§è½‰æ›é¡åˆ¥"""
    # å¯¦ä½œ...
```

#### 2. **é‡è¤‡çš„ clean_path å‡½æ•¸**
**å•é¡Œ**: åœ¨ `backend/tts/GPT-SoVITS/tools/my_utils.py` ä¸­é‡è¤‡å®šç¾©
**è§£æ±ºæ–¹æ¡ˆ**: ç§»é™¤é‡è¤‡å®šç¾©ï¼Œä¿ç•™ä¸€å€‹ç‰ˆæœ¬

## ğŸ”„ é‡è¤‡åŠŸèƒ½æª¢æŸ¥

### âœ… å·²è§£æ±ºçš„é‡è¤‡åŠŸèƒ½

#### 1. **API é‡‘é‘°ç®¡ç†**
- **ä½ç½®**: `frontend/chat/utils/api_key_manager.py`
- **è¨­è¨ˆ**: çµ±ä¸€çš„ API é‡‘é‘°ç®¡ç†ï¼Œæ”¯æ´å¤šç¨®æä¾›å•†
- **å„ªé»**: é¿å…é‡è¤‡çš„ API é…ç½®ä»£ç¢¼

#### 2. **ç’°å¢ƒé…ç½®ç®¡ç†**
- **ä½ç½®**: `backend/utils/env_config.py` å’Œ `frontend/chat/utils/env_config.py`
- **è¨­è¨ˆ**: çµ±ä¸€çš„é…ç½®ç®¡ç†é¡åˆ¥
- **å„ªé»**: é›†ä¸­ç®¡ç†æ‰€æœ‰ç’°å¢ƒè®Šæ•¸

### âš ï¸ éœ€è¦è§£æ±ºçš„é‡è¤‡åŠŸèƒ½

#### 1. **é…ç½®é¡åˆ¥é‡è¤‡**
**å•é¡Œ**: `PodriConfig` é¡åˆ¥åœ¨å…©å€‹ä½ç½®å®šç¾©
- `backend/utils/env_config.py`
- `frontend/chat/utils/env_config.py`

**è§£æ±ºæ–¹æ¡ˆ**: å‰µå»ºå…±ç”¨çš„é…ç½®æ¨¡çµ„

#### 2. **å·¥å…·å‡½æ•¸é‡è¤‡**
**å•é¡Œ**: å¤šå€‹æª”æ¡ˆä¸­é‡è¤‡çš„å·¥å…·å‡½æ•¸
**è§£æ±ºæ–¹æ¡ˆ**: å‰µå»º `backend/utils/common_utils.py`

## ğŸ”— RAG Pipeline æ•´åˆæª¢æŸ¥

### âœ… æ•´åˆç‹€æ…‹è‰¯å¥½

#### 1. **API ç«¯é»æ•´åˆ**
- **podri_chat.py**: å®Œæ•´çš„ RAG æ•´åˆå¯¦ä½œ
- **ç«¯é»**: `/chat`, `/health`, `/query`
- **éŒ¯èª¤è™•ç†**: å®Œæ•´çš„é‡è©¦æ©Ÿåˆ¶å’ŒéŒ¯èª¤è™•ç†

#### 2. **æœå‹™ç™¼ç¾æ©Ÿåˆ¶**
```python
# å¤šå±¤æœå‹™ç™¼ç¾
rag_urls = [
    self.k8s_rag_url,      # K8s æœå‹™åç¨±
    self.container_rag_url, # å®¹å™¨ç’°å¢ƒ
    self.rag_url           # æœ¬åœ°é–‹ç™¼
]
```

#### 3. **æ™ºèƒ½ API é¸æ“‡**
- å‘é‡æœå°‹å„ªå…ˆ
- å¤š API å‚™æ´æ©Ÿåˆ¶
- å¿«å–æ©Ÿåˆ¶

### âš ï¸ éœ€è¦æ”¹é€²çš„æ•´åˆ

#### 1. **éŒ¯èª¤è™•ç†å¢å¼·**
**å»ºè­°**: æ·»åŠ æ›´è©³ç´°çš„éŒ¯èª¤æ—¥èªŒå’Œç›£æ§

#### 2. **æ€§èƒ½å„ªåŒ–**
**å»ºè­°**: æ·»åŠ é€£æ¥æ± å’Œè«‹æ±‚å¿«å–

## ğŸ³ Podman éƒ¨ç½²æª¢æŸ¥

### âœ… Podman æ”¯æ´ç‹€æ…‹

#### 1. **Docker Compose å…¼å®¹æ€§**
- **æª”æ¡ˆ**: `docker-compose.yaml`
- **ç‹€æ…‹**: å®Œå…¨å…¼å®¹ Podman Compose
- **æœå‹™**: æ‰€æœ‰æœå‹™éƒ½å·²å®¹å™¨åŒ–

#### 2. **Podman ç‰¹å®šé…ç½®**
**å»ºè­°æ·»åŠ **: `podman-compose.yaml` æˆ–ä½¿ç”¨ `docker-compose.yaml`

### âš ï¸ éœ€è¦æ”¹é€²çš„éƒ¨ç½²

#### 1. **Podman ç‰¹å®šå„ªåŒ–**
**å»ºè­°**: 
```yaml
# æ·»åŠ  Podman ç‰¹å®šé…ç½®
services:
  rag_pipeline:
    image: localhost/podwise/rag_pipeline:latest
    # Podman ç‰¹å®šé…ç½®
```

#### 2. **å»ºç½®è…³æœ¬**
**å»ºè­°**: å‰µå»º Podman å°ˆç”¨å»ºç½®è…³æœ¬

## ğŸ“Š ä»£ç¢¼å“è³ªè©•ä¼°

### âœ… å„ªç§€çš„è¨­è¨ˆæ¨¡å¼

#### 1. **ç­–ç•¥æ¨¡å¼**
- API é¸æ“‡ç­–ç•¥
- å…§å®¹è™•ç†ç­–ç•¥

#### 2. **å·¥å» æ¨¡å¼**
- æœå‹™å‰µå»ºå·¥å» 
- æ¨¡å‹å‰µå»ºå·¥å» 

#### 3. **è§€å¯Ÿè€…æ¨¡å¼**
- äº‹ä»¶é©…å‹•æ¶æ§‹
- ç‹€æ…‹è®Šæ›´é€šçŸ¥

### âš ï¸ éœ€è¦æ”¹é€²çš„è¨­è¨ˆ

#### 1. **å–®ä¸€è·è²¬åŸå‰‡**
**å•é¡Œ**: æŸäº›é¡åˆ¥è·è²¬éå¤š
**è§£æ±ºæ–¹æ¡ˆ**: é€²ä¸€æ­¥æ‹†åˆ†è·è²¬

#### 2. **ä¾è³´åè½‰åŸå‰‡**
**å»ºè­°**: å¢åŠ ä»‹é¢æŠ½è±¡å±¤

## ğŸš€ éƒ¨ç½²æº–å‚™æª¢æŸ¥

### âœ… æº–å‚™å°±ç·’çš„çµ„ä»¶

#### 1. **å®¹å™¨åŒ–**
- æ‰€æœ‰æœå‹™éƒ½æœ‰ Dockerfile
- å®Œæ•´çš„ docker-compose.yaml
- å¥åº·æª¢æŸ¥é…ç½®

#### 2. **é…ç½®ç®¡ç†**
- ç’°å¢ƒè®Šæ•¸é…ç½®
- å¤šç’°å¢ƒæ”¯æ´
- å®‰å…¨é…ç½®

#### 3. **ç›£æ§å’Œæ—¥èªŒ**
- çµæ§‹åŒ–æ—¥èªŒ
- å¥åº·æª¢æŸ¥ç«¯é»
- éŒ¯èª¤è¿½è¹¤

### âš ï¸ éƒ¨ç½²å‰éœ€è¦ä¿®å¾©çš„å•é¡Œ

#### 1. **é‡è¤‡ä»£ç¢¼æ¸…ç†**
- ç§»é™¤é‡è¤‡çš„ `DictToAttrRecursive` é¡åˆ¥
- çµ±ä¸€ `clean_path` å‡½æ•¸
- åˆä½µé‡è¤‡çš„é…ç½®é¡åˆ¥

#### 2. **ä¾è³´ç®¡ç†**
- æª¢æŸ¥ requirements.txt ä¸€è‡´æ€§
- ç¢ºä¿ç‰ˆæœ¬å…¼å®¹æ€§

## ğŸ“‹ ä¿®å¾©å»ºè­°

### ğŸ”§ ç«‹å³ä¿®å¾©é …ç›®

#### 1. **å‰µå»ºå…±ç”¨å·¥å…·æ¨¡çµ„**
```python
# backend/utils/common_utils.py
class DictToAttrRecursive(dict):
    """çµ±ä¸€çš„å­—å…¸åˆ°å±¬æ€§è½‰æ›é¡åˆ¥"""
    def __init__(self, input_dict):
        super().__init__(input_dict)
        for key, value in input_dict.items():
            if isinstance(value, dict):
                value = DictToAttrRecursive(value)
            self[key] = value
            setattr(self, key, value)

def clean_path(path_str: str) -> str:
    """çµ±ä¸€çš„è·¯å¾‘æ¸…ç†å‡½æ•¸"""
    if path_str.endswith(("\\", "/")):
        return clean_path(path_str[0:-1])
    path_str = path_str.replace("/", os.sep).replace("\\", os.sep)
    return path_str.strip(" '\n\"\u202a")
```

#### 2. **çµ±ä¸€é…ç½®ç®¡ç†**
```python
# backend/config/base_config.py
class BaseConfig:
    """åŸºç¤é…ç½®é¡åˆ¥"""
    def __init__(self):
        self.load_environment_config()
    
    def load_environment_config(self):
        """è¼‰å…¥ç’°å¢ƒé…ç½®"""
        # çµ±ä¸€çš„é…ç½®è¼‰å…¥é‚è¼¯
        pass
```

#### 3. **Podman éƒ¨ç½²è…³æœ¬**
```bash
#!/bin/bash
# deploy-podman.sh

# å»ºç½®æ˜ åƒ
podman build -t localhost/podwise/rag_pipeline:latest ./backend/rag_pipeline
podman build -t localhost/podwise/tts:latest ./backend/tts
podman build -t localhost/podwise/stt:latest ./backend/stt

# å•Ÿå‹•æœå‹™
podman-compose up -d
```

### ğŸ”„ ä¸­æœŸæ”¹é€²é …ç›®

#### 1. **é‡æ§‹é‡è¤‡ä»£ç¢¼**
- ç§»é™¤æ‰€æœ‰é‡è¤‡çš„é¡åˆ¥å®šç¾©
- çµ±ä¸€å·¥å…·å‡½æ•¸
- æ¨™æº–åŒ–é…ç½®ç®¡ç†

#### 2. **å¢å¼·éŒ¯èª¤è™•ç†**
- æ·»åŠ æ›´è©³ç´°çš„éŒ¯èª¤æ—¥èªŒ
- å¯¦ä½œé‡è©¦æ©Ÿåˆ¶
- æ·»åŠ ç›£æ§æŒ‡æ¨™

#### 3. **æ€§èƒ½å„ªåŒ–**
- æ·»åŠ é€£æ¥æ± 
- å¯¦ä½œå¿«å–æ©Ÿåˆ¶
- å„ªåŒ–è³‡æ–™åº«æŸ¥è©¢

## ğŸ¯ çµè«–

### âœ… å°ˆæ¡ˆå„ªå‹¢
1. **å„ªç§€çš„ OOP æ¶æ§‹è¨­è¨ˆ**
2. **å®Œæ•´çš„å¾®æœå‹™æ¶æ§‹**
3. **è‰¯å¥½çš„ RAG Pipeline æ•´åˆ**
4. **å®Œæ•´çš„å®¹å™¨åŒ–æ”¯æ´**

### âš ï¸ éœ€è¦ä¿®å¾©çš„å•é¡Œ
1. **é‡è¤‡ä»£ç¢¼å•é¡Œ** (é«˜å„ªå…ˆç´š)
2. **é…ç½®ç®¡ç†é‡è¤‡** (ä¸­å„ªå…ˆç´š)
3. **Podman ç‰¹å®šå„ªåŒ–** (ä½å„ªå…ˆç´š)

### ğŸš€ éƒ¨ç½²å»ºè­°
1. **ç«‹å³ä¿®å¾©é‡è¤‡ä»£ç¢¼å•é¡Œ**
2. **çµ±ä¸€é…ç½®ç®¡ç†**
3. **æ¸¬è©¦ Podman éƒ¨ç½²**
4. **æº–å‚™ GitHub ä¸Šå‚³**

## ğŸ“ ä¸‹ä¸€æ­¥è¡Œå‹•

### 1. **ä¿®å¾©é‡è¤‡ä»£ç¢¼** (1-2 å°æ™‚)
- å‰µå»ºå…±ç”¨å·¥å…·æ¨¡çµ„
- ç§»é™¤é‡è¤‡å®šç¾©
- æ›´æ–°æ‰€æœ‰å¼•ç”¨

### 2. **çµ±ä¸€é…ç½®ç®¡ç†** (1 å°æ™‚)
- å‰µå»ºåŸºç¤é…ç½®é¡åˆ¥
- ç§»é™¤é‡è¤‡é…ç½®
- æ¸¬è©¦é…ç½®è¼‰å…¥

### 3. **Podman éƒ¨ç½²æ¸¬è©¦** (30 åˆ†é˜)
- å‰µå»º Podman éƒ¨ç½²è…³æœ¬
- æ¸¬è©¦å®¹å™¨å»ºç½®
- é©—è­‰æœå‹™å•Ÿå‹•

### 4. **GitHub ä¸Šå‚³æº–å‚™** (30 åˆ†é˜)
- æ›´æ–° README.md
- æ·»åŠ éƒ¨ç½²èªªæ˜
- æº–å‚™ç‰ˆæœ¬æ¨™ç±¤

**ç¸½è¨ˆé ä¼°æ™‚é–“**: 3-4 å°æ™‚

å°ˆæ¡ˆæ•´é«”å“è³ªè‰¯å¥½ï¼Œåªéœ€è¦ä¿®å¾©ä¸€äº›é‡è¤‡ä»£ç¢¼å•é¡Œå³å¯æº–å‚™ä¸Šå‚³åˆ° GitHubã€‚ 